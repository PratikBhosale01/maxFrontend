<app-loader *ngIf="loader"></app-loader>
<div mat-dialog-title style="background-color: rgb(35, 30, 9)">
  <h2 style="color: gold; font-size: 24px; padding-bottom: 3px">
    {{ dataSourceType }}
    <span style="color: rgb(246, 245, 241); font-weight: 300"
      >| {{ dataSource }}</span
    >
  </h2>
</div>

<mat-dialog-content>
  <div class="row">
    <div class="col-sm-8">
      <input
        class="inp"
        matInput
        placeholder="Search"
        #input
        (input)="updateSearchText(input.value)"
        (keydown.enter)="onEnter(input.value)"
      />
    </div>
    @if(dataSourceType==="Total"){
    <div class="col-sm-3 date">
      <mat-form-field style="color: gray">
        <mat-label style="color: gray">Enter a date range</mat-label>
        <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
          <input
            matStartDate
            formControlName="start"
            placeholder="Start date"
          />
          <input matEndDate formControlName="end" placeholder="End date" />
        </mat-date-range-input>
        <mat-datepicker-toggle
          style="color: gray"
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-date-range-picker
          style="color: gray"
          #picker
        ></mat-date-range-picker>
        <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')"
          >Invalid start date</mat-error
        >
        <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')"
          >Invalid end date</mat-error
        >
      </mat-form-field>
    </div>
    }
    <div class="col-sm-1" *ngIf="StartDate">
      <button
        class="b1"
        id="b2" data-toggle="tooltip" data-placement="top" title="Total Report"
        style="background-color: #e2bd01"
        (click)="getRangeExceldata()"
      >
        <div class="icon">
          <span class="material-symbols-outlined"> download </span>
        </div>
      </button>
    </div>
    @if(dataSourceType==="Today's"){
      <div class="col-sm-1" *ngIf="StartDate">
        <button
          class="b1"
          id="b2" data-toggle="tooltip" data-placement="top" title="Success Report"
          style="background-color: #01e21f"
          (click)="getTodaySuccessExceldata()"
        >
          <div class="icon">
            <span class="material-symbols-outlined"> download </span>
          </div>
        </button>
      </div>
      <div class="col-sm-1" *ngIf="StartDate">
        <button
          class="b1"
          id="b2" data-toggle="tooltip" data-placement="top" title="Failure Report"
          style="background-color: #e26e01"
          (click)="getTodayFailureExceldata()"
        >
          <div class="icon">
            <span class="material-symbols-outlined"> download </span>
          </div>
        </button>
      </div>

    }
  </div>

  <div class="row">
    <table class="tbl" mat-table [dataSource]="deposits">
      <!-- Position Column -->
      <ng-container matColumnDef="position">
        <th mat-header-cell *matHeaderCellDef>No.</th>
        <td
          mat-cell
          *matCellDef="let element; let i = index"
          style="color: rgb(241, 237, 237)"
        >
          {{ getSerialNumber(i) }}
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="userId">
        <th mat-header-cell *matHeaderCellDef>UserId</th>
        <td mat-cell *matCellDef="let element">{{ element.userId }}</td>
      </ng-container>

      <!-- @if(data==="Deposit"){ -->
      <ng-container matColumnDef="utrNumber">
        <th mat-header-cell *matHeaderCellDef>UtrNumber</th>
        <td mat-cell *matCellDef="let element">{{ element.utrNumber }}</td>
      </ng-container>
      <!-- } -->
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Amount</th>
        <td mat-cell *matCellDef="let element">{{ element.amount }}</td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date / Time</th>
        <td mat-cell *matCellDef="let element">
          {{ getFormattedDate(element.entryTime) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        @if (dataSource === "Deposit") {
       
        <td mat-cell *matCellDef="let element">{{ element.approveStatus }}</td>}
        @else{
          <td mat-cell *matCellDef="let element">{{ element.approveWithdrawStatus }}</td>
        }
      </ng-container>

      <ng-container matColumnDef="siteName">
        <th mat-header-cell *matHeaderCellDef>SiteName</th>
        <td mat-cell *matCellDef="let element">{{ element.site.name }}</td>
      </ng-container>

      <ng-container matColumnDef="BotUserName">
        <th mat-header-cell *matHeaderCellDef>BotUserName</th>
        <td mat-cell *matCellDef="let element">
          @if(element.requestBy){ {{ element.requestBy.username }} }@else {"No value"}
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns"
        style="background-color: rgb(35, 30, 9); color: gold"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        style="color: white"
      ></tr>
    </table>
  </div>
  <button mat-icon-button mat-dialog-close class="close-button">
    <mat-icon style="color: gold">close</mat-icon>
  </button>
</mat-dialog-content>

<mat-dialog-actions>
  <mat-paginator
    [length]="totalElements"
    [pageSize]="size"
    (page)="onPageChange($event)"
    [pageIndex]="page"
  ></mat-paginator>
  <mat-form-field>
    <mat-label style="color: aliceblue">Go to page</mat-label>
    <input
      matInput
      type="number"
      (keydown.enter)="onPageInputChange($event)"
      [min]="1"
      [max]="cumulativeCount"
      [(ngModel)]="inputPage"
    />
  </mat-form-field>
</mat-dialog-actions>

